/*
* Square1 Slider
* Copyright (c) 2016 Thom Hines
* Licensed under MIT.
* @author Thom Hines
* https://github.com/thomhines/square1
* @version 0.3.0
*/


(function(e){e.fn.square1=function(a){function t(){l=1,r(),u(),c.onPlay()}function n(){clearInterval(l),c.onStop()}function r(){l&&(clearInterval(l),l=setInterval(i,c.slide_duration+c.transition_time),e(_).data("interval",l))}function i(){var a=e(".current_slide",_).index();o(a==e(".image_wrapper",_).length-1?0:a+1)}function s(){var a=e(".current_slide",_).index();o(0==a?e(".image_wrapper",_).last().index():a-1)}function o(a){e(".image_wrapper",_).finish().clearQueue(),"slide"==c.animation?(e(".current_slide",_).removeClass("current_slide"),e(".image_wrapper",_).eq(a).addClass("current_slide"),translate_target=a*-100,e(".image_wrapper",_).animate({borderspacing:translate_target},{step:function(a,t){e(this).css("transform","translateX("+a+"%)")},duration:c.transition_time})):"cover"==c.fill_mode?a>e(".current_slide",_).index()?(e(".current_slide",_).removeClass("current_slide"),e(".image_wrapper",_).eq(a).addClass("current_slide").fadeIn(c.transition_time,function(){e(".image_wrapper:not(.current_slide)",_).hide()})):a<e(".current_slide",_).index()&&(e(".current_slide",_).removeClass("current_slide").fadeOut(c.transition_time),e(".image_wrapper",_).eq(a).addClass("current_slide").show()):(e(".current_slide",_).removeClass("current_slide").fadeOut(c.transition_time),e(".image_wrapper",_).eq(a).addClass("current_slide").fadeIn(c.transition_time)),r(),d(),u(),c.onChange()}function d(){return"none"==c.caption?void e(".square1_caption",_).remove():void e(".square1_caption",_).fadeOut(c.transition_time,function(){setTimeout(function(){e(".square1_caption",_).html(e(".current_slide img",_).attr("alt")).fadeIn(c.transition_time-200)},10)})}function u(){return"none"==c.dots_nav?void e(".square1_dots",_).remove():(e(".square1_dots span",_).removeClass("current"),void e('.square1_dots span[data-image-num="'+e(".current_slide",_).index()+'"]',_).addClass("current"))}var c,l,_=this;if(!(_.length<1)){if(e(_).data("settings")){var c=e(_).data("settings");l=e(_).data("interval")}else{var c=e.extend({width:"",height:"",fill_mode:"cover",scale_from:"center center",background:"none",auto_start:!0,start_delay:0,slide_duration:4e3,transition_time:500,pause_on_hover:!1,keyboard:!0,gestures:!0,theme:"dark",prev_next_nav:"inside",dots_nav:"inside",caption:"outside",onPlay:function(){},onStop:function(){},onChange:function(){}},a);e(_).data("settings",c)}if("play"==a)return void t();if("stop"==a)return c.auto_start=!1,void n();if("next"==a)return i(),void(c.auto_start&&r());if("prev"==a)return s(),void(c.auto_start&&r());if(Math.floor(a)===a&&+a===a)return o(a-1),void(c.auto_start&&r());e(_).css({position:"relative",width:c.width,height:c.height,background:c.background}),_.addClass("square1"),c.keyboard&&!_.attr("tabindex")&&_.attr("tabindex",0),e(_).children().wrap('<div class="image_wrapper" />'),e(".image_wrapper",_).each(function(){if($img=e(this).find("img"),$img.prop("currentSrc"))var a=$img.prop("currentSrc");else var a=$img.attr("src");e(this).css("background-image","url("+a+")"),$img.attr("scale-from")?e(this).css("background-position",$img.attr("scale-from")):c.scale_from&&e(this).css("background-position",c.scale_from)}),e(".image_wrapper:first",_).addClass("current_slide"),e(".image_wrapper:not(.current_slide)",_).hide(),e(_).append('<div class="square1_caption"></div>'),e(_).append('<div class="square1_controls"><span class="square1_prev_image">Previous Image</span><span class="square1_next_image">Next Image</span><div class="square1_dots"></div></div>'),e(_).append('<div class="square1_spinner"></div>');var p=0;if(e(".image_wrapper",_).each(function(){e(".square1_dots",_).append('<span data-image-num="'+p+'"></span>'),p++}),e(".square1_dots span:first-child",_).addClass("current"),"slide"==c.animation){_.addClass("slide_animation"),e(".image_wrapper",_).show();var p=0;e(".image_wrapper",_).each(function(){e(this).css("left",100*p+"%"),p++})}if(e(_).addClass("fill_mode-"+c.fill_mode),e(_).addClass("theme-"+c.theme),e(_).addClass("prev_next_nav-"+c.prev_next_nav),e(_).addClass("dots_nav-"+c.dots_nav),e(_).addClass("caption-"+c.caption),e(".square1_prev_image",_).click(function(){s()}),e(".square1_next_image",_).click(function(){i()}),e(".square1_dots span",_).click(function(){o(e(this).data("image-num"))}),e(_).keydown(function(e){if(37==e.keyCode||38==e.keyCode)s();else{if(39!=e.keyCode&&40!=e.keyCode)return;i()}e.preventDefault(),e.stopPropagation()}),c.gestures){var m,f,v,g;e(_).on("touchstart",function(e){m=e.touches[0].screenX,f=e.touches[0].screenY,v=new Date}),e(_).on("touchmove",function(e){g=e}),e(_).on("touchend",function(e){deltaX=g.touches[0].screenX-m,deltaY=g.touches[0].screenY-f,touchDuration=new Date-v,Math.abs(deltaX/deltaY)<2||Math.abs(deltaX)<30||touchDuration>800||(deltaX>0?s():i())})}return e(_).on("mouseenter",".image_wrapper",function(){c.pause_on_hover&&n()}),e(_).on("mouseleave",".image_wrapper",function(){c.pause_on_hover&&c.auto_start&&t()}),c.auto_start&&setTimeout(t,c.start_delay),d(),_}}})(jQuery);